var TemplateSelector;function format(t,e){return $.each(e,(function(e,a){t=t.replace(new RegExp("\\{"+e+"\\}","g"),a)})),t}!function(t){TemplateSelector={init:function(){TemplateSelector.binds()},binds:function(){t(".event-template-item a").on("click",TemplateSelector.__setEventTemplateValues),t(".product-template-item a").on("click",TemplateSelector.__setProductTemplateValues)},__setEventTemplateValues:function(e){e.preventDefault();var a=t(e.target).parent().data("template");t.each(a,(function(e,a){t("#"+e).val(a)})),TemplateSelector.__setCategories(a),TemplateSelector.__setTimes(a)},__setProductTemplateValues:function(e){e.preventDefault();var a=t(e.target).parent().data("template");t.each(a,(function(e,a){var r=e.replace(/\b\w/g,(function(t){return t.toUpperCase()})),o=t("#product"+r);o.val(a),"chOnly"===e&&!0===a?o.attr("checked","checked"):o.removeAttr("checked"),"reservable"===e&&!0===a?o.attr("checked","checked"):o.removeAttr("checked")}))},__setCategories:function(e){t("input[name='categories']").each((function(){t.inArray(t(this).val(),e.categories)>=0?t(this).attr("checked","checked"):t(this).removeAttr("checked")}))},__setTimes:function(t){document.querySelector("#start")._flatpickr.setDate(t.startingTime),document.querySelector("#ending")._flatpickr.setDate(t.endingTime)}}}(jQuery),$(document).ready((function(){TemplateSelector.init();var t={enableTime:!0,altInput:!0,altFormat:"F j, Y H:i",dateFormat:"Y-m-dTH:i:S",time_24hr:!0};$("#ending").flatpickr(t),$("#start").flatpickr(t),$("#productSellStart").flatpickr(t),$("#productSellEnd").flatpickr(t),$("#q").autocomplete({serviceUrl:"/api/v1/products/search/unused",onSelect:function(t){r(t.data,t.value),$(this).val(""),$("#addProduct").modal("hide")}});const e=document.getElementById("externalProductUrl");function a(){$("#products").children().length>0&&""!==e.value?e.setCustomValidity("It is not possible to use products when using an external product URL."):e.setCustomValidity("")}function r(t,e){var r=$("#products"),o=r.children().length;$("#productsTable").append(format("<tr><td><span class='fa fa-exclamation-triangle' data-toggle='tooltip' data-placement='right' title='Do not forget to update the event!'></span> {0}</td><td style='width: 40px;'><a class='btn btn-xs btn-danger text-white remove-product' data-product-id='{1}'><i class='fas fa-trash-alt'></i></a></td></tr>",[e,t])),r.append(format('<input type="hidden" id="products{0}" name="products[{1}]" value="{2}">',[o,o,t])),$("#noProducts").remove(),$((function(){$('[data-toggle="tooltip"]').tooltip()})),a()}e.addEventListener("input",a),$(".remove-product").on("click",(function(t){t.preventDefault();var e=$("#products"),r=e.children().length,o=$(this).data("product-id"),c=e.find(":input[value='"+o+"']"),n=c.attr("id").replace("products","");c.remove(),$(this).parent().parent().remove();for(var l=n;l<r;l++){var d=e.find("#products"+l);d.attr("id","products"+(l-1)),d.attr("name","products["+(l-1)+"]")}a()})),$("#createNewProductButton").on("click",(function(t){if(t.preventDefault(),function(){var t=!1;return $("#newProductModalError").hide(),$("#addProductForm").find("select, textarea, input").each((function(){$(this).hasClass("required")&&($(this).val()?$(this).parent().removeClass("has-error"):($(this).parent().addClass("has-error"),t=!0))})),t}())$("#newProductModalError").show();else{var e={title:$("#productTitle").val(),description:$("#productDescription").val(),redirectUrl:$("#productRedirectUrl").val(),cost:$("#productCost").val(),vatRate:$("#productVatRate").val(),maxSold:$("#maxSold").val(),maxSoldPerCustomer:$("#productMaxSoldPerCustomer").val(),sellStart:""===$("#productSellStart").val()?null:$("#productSellStart").val(),sellEnd:""===$("#productSellEnd").val()?null:$("#productSellEnd").val(),chOnly:$("#productChOnly").prop("checked"),reservable:$("#productReservable").prop("checked")};$.ajax({url:"/api/v1/products",type:"POST",headers:{"Content-Type":"application/json"},dataType:"json",cache:!1,data:JSON.stringify(e),success:function(t){r(t.object.product_id,t.object.product_title),$("#addProduct").modal("hide")},error:function(t){alert(t.message)}})}}))}));
