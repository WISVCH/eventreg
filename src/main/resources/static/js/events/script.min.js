var TemplateSelector;(function(a){TemplateSelector={init:function(){TemplateSelector.binds()},binds:function(){a(".event-template-item a").on("click",TemplateSelector.__setEventTemplateValues);a(".product-template-item a").on("click",TemplateSelector.__setProductTemplateValues)},__setEventTemplateValues:function(c){c.preventDefault();var b=a(c.target).parent().data("template");a.each(b,function(d,e){a("#"+d).val(e)});TemplateSelector.__setCategories(b);TemplateSelector.__setTimes(b)},__setProductTemplateValues:function(c){c.preventDefault();var b=a(c.target).parent().data("template");a.each(b,function(f,g){var d=f.replace(/\b\w/g,function(h){return h.toUpperCase()});var e=a("#product"+d);e.val(g);if(f==="chOnly"&&g===true){e.attr("checked","checked")}else{e.removeAttr("checked")}})},__setCategories:function(b){a("input[name='categories']").each(function(){if(a.inArray(a(this).val(),b.categories)>=0){a(this).attr("checked","checked")}else{a(this).removeAttr("checked")}})},__setTimes:function(b){document.querySelector("#start")._flatpickr.setDate(b.startingTime);document.querySelector("#ending")._flatpickr.setDate(b.endingTime)}}})(jQuery);$(document).ready(function(){TemplateSelector.init();var b={enableTime:true,altInput:true,altFormat:"F j, Y H:i",dateFormat:"Y-m-dTH:i:S",time_24hr:true};$("#ending").flatpickr(b);$("#start").flatpickr(b);$("#productSellStart").flatpickr(b);$("#productSellEnd").flatpickr(b);$("#q").autocomplete({serviceUrl:"/events/api/v1/products/search/unused",onSelect:function(e){a(e.data,e.value);$(this).val("");$("#addProduct").modal("hide")}});$(".remove-product").on("click",function(l){l.preventDefault();var k=$("#products");var j=k.children().length;var g=$(this).data("product-id");var f=k.find(":input[value='"+g+"']");var n=f.attr("id").replace("products","");f.remove();$(this).parent().parent().remove();for(var h=n;h<j;h++){var m=k.find("#products"+h);m.attr("id","products"+(h-1));m.attr("name","products["+(h-1)+"]")}});$("#createNewProductButton").on("click",function(h){h.preventDefault();var f=c();if(f){}else{var g={title:$("#productTitle").val(),description:$("#productDescription").val(),cost:$("#productCost").val(),maxSold:$("#maxSold").val(),maxSoldPerCustomer:$("#productMaxSoldPerCustomer").val(),sellStart:$("#productSellStart").val()===""?null:$("#productSellStart").val(),sellEnd:$("#productSellEnd").val()===""?null:$("#productSellEnd").val(),chOnly:$("#productChOnly").val()==="on"};$.ajax({url:"/events/api/v1/products",type:"POST",headers:{"Content-Type":"application/json"},dataType:"json",cache:false,data:JSON.stringify(g),success:function(e){a(e.object.product_id,e.object.product_title);$("#addProduct").modal("hide")},error:function(e){alert(e.message)}})}});function c(){var e=false;$("#addProductForm").find("select, textarea, input").each(function(){if(!$(this).hasClass("required")){}else{if(!$(this).val()){$(this).parent().addClass("has-error");e=true}else{$(this).parent().removeClass("has-error")}}});return e}function a(f,i){var e='<input type="hidden" id="products{0}" name="products[{1}]" value="{2}">';var g="<tr><td><span class='fa fa-exclamation-triangle' data-toggle='tooltip' data-placement='right' title='Do not forget to update the event!'></span> {0}</td><td style='width: 40px;'><a class='btn btn-xs btn-danger text-white remove-product' data-product-id='{1}'><i class='fas fa-trash-alt'></i></a></td></tr>";var j=$("#products");var h=j.children().length;$("#productsTable").append(format(g,[i,f]));j.append(format(e,[h,h,f]));$("#noProducts").remove();d()}function d(){$(function(){$('[data-toggle="tooltip"]').tooltip()})}});function format(a,b){$.each(b,function(c,d){a=a.replace(new RegExp("\\{"+c+"\\}","g"),d)});return a};